################################################
## SHADDOCK: Services Architecture Definition ##
################################################

- name: rabbitmq
  image: shaddock/rabbitmq
  priority: 10
  ports:
    - 5672
    - 15672
  volumes:
    - mount: /data/log
      host_dir: /var/lib/rabbitmq/log
    - mount: /data/mnesia
      host_dir: /var/lib/rabbitmq/mnesia


- name: mysql
  image: shaddock/mysql
  priority: 20
  ports:
    - 3306
  volumes:
    - mount: /var/log/supervisor
      host_dir: /var/log/shaddock/mysql


- name: keystone
  image: shaddock/keystone
  priority: 30
  ports:
    - 35357
    - 5000
  volumes:
    - mount: /var/log/supervisor
<<<<<<< HEAD
      host_dir: /var/log/shaddock/keystone
  depends-on:
    - {name: mysql, port: 3306}


- name: seed
  image: shaddock/seed
  priority: 35
  depends-on:
    - {name: keystone, port: 5000, get: '/v2.0'}
    - {name: keystone, port: 35357, get: '/v2.0'}
=======
      host_dir: /var/log/shaddock/keystone 
  depend-on:
    - running: mysql
      net: 3306
>>>>>>> f41b8b67cbff19637cf9831af26fc0a48299ae13


- name: seed
  image: shaddock/seed
  priority: 30

- name: nova
  image: shaddock/nova
  priority: 40
  ports:
    - 8774
    - 8775
  volumes:
    - mount: /var/log/nova
      host_dir: /var/log/shaddock/nova
  privileged: True
<<<<<<< HEAD
  depends-on:
    - {name: seed, status: stopped}
    - {name: mysql, port: 3306}
    - {name: rabbitmq, port: 5672}
    - {name: keystone, port: 5000, get: '/v2.0'}
    - {name: keystone, port: 35357, get: '/v2.0'}
=======
  depend-on:
    - running: mysql
      net: 3306
    - running: keystone
      net: 35357
      net: 5000
>>>>>>> f41b8b67cbff19637cf9831af26fc0a48299ae13


- name: glance
  image: shaddock/glance
  priority: 50
  ports:
    - 9292
    - 4324
  volumes:
    - mount: /var/log/supervisor
      host_dir: /var/log/shaddock/glance
<<<<<<< HEAD
  depends-on:
    - {name: seed, status: stopped}
    - {name: mysql, port: 3306}
    - {name: keystone, port: 5000, get: '/v2.0'}
    - {name: keystone, port: 35357, get: '/v2.0'}
=======
  depend-on:
    - running: mysql
      net: 3306
    - running: keystone
      net: 35357
      net: 5000
>>>>>>> f41b8b67cbff19637cf9831af26fc0a48299ae13


- name: horizon
  image: shaddock/horizon
  priority: 60
  ports:
    - 80
    - 11211
  volumes:
    - mount: /var/log/supervisor
      host_dir: /var/log/shaddock/horizon
<<<<<<< HEAD
  depends-on:
    - {name: seed, status: stopped}
    - {name: mysql, port: 3306}
    - {name: keystone, port: 5000, get: '/v2.0'}
    - {name: keystone, port: 35357, get: '/v2.0'}


- name: horizon2
=======
  depend-on:
    - running: mysql
      net: 3306
    - running: keystone
      net: 35357
      net: 5000


- name: horizon2 
>>>>>>> f41b8b67cbff19637cf9831af26fc0a48299ae13
  image: shaddock/horizon
  priority: 60
  ports:
    - 81
<<<<<<< HEAD
    - 11212
  volumes:
    - mount: /var/log/supervisor
      host_dir: /var/log/shaddock/horizon2
  depends-on:
    - {name: seed, status: stopped}
    - {name: mysql, port: 3306}
    - {name: keystone, port: 5000, get: '/v2.0'}
    - {name: keystone, port: 35357, get: '/v2.0'}
=======
    - 1111
  volumes:
    - mount: /var/log/supervisor
      host_dir: /var/log/shaddock/horizon2
  depend-on:
    - running: mysql
      net: 3306
    - running: keystone
      net: 35357
      net: 5000


- name: nova-compute
  image: shaddock/nova-compute
  volumes:
    - mount: /var/log/nova
      host_dir: /var/log/shaddock/compute
  privileged: True
  network_mode: host
  priority: 90
  depend-on:
    - running: nova
      net: 8774
      net: 8775
    - running: mysql
      net: 3306
    - running: keystone
      net: 35357
      net: 5000
      net: {port: 5000, get: '/v2.0', code: 200}
    - running: rabbitmq
      net: 5672
      net: 15672
>>>>>>> f41b8b67cbff19637cf9831af26fc0a48299ae13

# - name: nova-compute
  # image: shaddock/nova-compute
  # volumes:
    # - mount: /var/log/nova
      # host_dir: /var/log/shaddock/compute
  # privileged: True
  # network_mode: host
  # priority: 90
  # depends-on:
  #   - {name: nova}
  #   - {name: nova, status: stopped}
  #   - {name: nova, port: 8774, type: tcp}
  #   - {name: nova, port: 8774, state: down, type: tcp}
  #   - {host: google.com, port: 8774, state: down, type: tcp}
  #   - {name: nova, type: http, get: '/v2.0', port: 5000, code: 200}
  #   - {host: google.com, type: http, get: '/v2.0', port: 5000, code: 200}
  #   - {host: 127.0.0.1, type: http, get: '/', code: 200, useproxy: False }
  #   - {name: nova, sleep: 20} # defaults to 10
  #   - {name: nova, retry: 10} # defaults to 5

- name: mistral
  image: shaddock/mistral
  ports:
    - 8989
  priority: 90
  volumes:
    - mount: /var/log/supervisor
      host_dir: /var/log/shaddock/mistral
<<<<<<< HEAD
  depends-on:
    - {name: seed, status: stopped}
    - {name: mysql, port: 3306}
    - {name: keystone, port: 5000, get: '/v2.0'}
    - {name: keystone, port: 35357, get: '/v2.0'}
=======
  depend-on:
    - running: mysql
      net: 3306
    - running: keystone
      net: 35357
      net: 5000
>>>>>>> f41b8b67cbff19637cf9831af26fc0a48299ae13
